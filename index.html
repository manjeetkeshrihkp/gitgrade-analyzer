<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GitGrade AI ‚Äì Repository Mirror</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

* { box-sizing: border-box; }

body {
  font-family: 'Inter', sans-serif;
  background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
  min-height: 100vh;
  margin: 0;
  padding: 30px 20px;
  color: #fff;
}

.container {
  max-width: 1200px;
  margin: auto;
}

.header {
  text-align: center;
  margin-bottom: 30px;
  animation: slideDown .8s ease;
}

@keyframes slideDown {
  from { opacity: 0; transform: translateY(-25px); }
  to { opacity: 1; transform: translateY(0); }
}

.input-card {
  max-width: 720px;
  margin: auto;
  background: rgba(255,255,255,.14);
  backdrop-filter: blur(16px);
  border-radius: 22px;
  padding: 24px;
  box-shadow: 0 30px 80px rgba(0,0,0,.4);
}

input, button {
  width: 100%;
  padding: 14px;
  border-radius: 14px;
  border: none;
  margin-bottom: 10px;
  font-size: 14px;
}

button {
  background: linear-gradient(135deg, #7f7cff, #5f5bff);
  color: #fff;
  font-weight: 600;
  cursor: pointer;
  transition: transform .2s ease, box-shadow .2s ease;
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(95,91,255,.6);
}

.dashboard {
  margin-top: 50px;
  animation: fadeIn 1s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(12px); }
  to { opacity: 1; transform: translateY(0); }
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px,1fr));
  gap: 22px;
}

.card {
  background: rgba(255,255,255,.16);
  backdrop-filter: blur(16px);
  border-radius: 22px;
  padding: 22px;
  transition: transform .3s ease, box-shadow .3s ease;
}

.card:hover {
  transform: translateY(-6px);
  box-shadow: 0 25px 60px rgba(0,0,0,.45);
}

.card h3 {
  margin-top: 0;
  font-size: 15px;
  color: #eaeaff;
}

.metric {
  font-size: 30px;
  font-weight: 700;
}

.small {
  font-size: 13px;
  color: #ccc;
}

.section {
  margin-top: 34px;
}

.chart-box {
  height: 260px;
}

ul {
  padding-left: 18px;
}

li {
  margin-bottom: 6px;
}
</style>
</head>

<body>

<div class="container">

  <div class="header">
    <h1>GitGrade AI</h1>
    <p>GitHub Project Analysis & Feedback Tool</p>
  </div>

  <div class="input-card">
    <input id="repoUrl" placeholder="https://github.com/username/repository">
    <input id="token" placeholder="Optional GitHub Token (classic or github_pat_)">
    <button onclick="analyzeRepo()">Analyze Repository</button>
  </div>

  <div id="dashboard" class="dashboard"></div>

</div>

<script>
function buildAuthHeader(token) {
  if (!token) return {};
  return token.startsWith("github_pat_")
    ? { Authorization: `Bearer ${token}` }
    : { Authorization: `token ${token}` };
}

async function analyzeRepo() {
  const url = document.getElementById("repoUrl").value.trim();
  const token = document.getElementById("token").value.trim();
  const dash = document.getElementById("dashboard");

  if (!url.startsWith("https://github.com/")) {
    dash.innerHTML = "<p>‚ùå Invalid GitHub URL</p>";
    return;
  }

  const clean = url.replace(/\/+$/, "").replace(".git", "");
  const p = clean.split("/");
  if (p.length < 5) {
    dash.innerHTML = "<p>‚ùå Invalid repository format</p>";
    return;
  }

  const owner = p[3];
  const repo = p[4];
  const headers = buildAuthHeader(token);

  dash.innerHTML = "<p>‚è≥ Fetching repository data‚Ä¶</p>";

  try {
    const repoRes = await fetch(`https://api.github.com/repos/${owner}/${repo}`, { headers });

    if (repoRes.status === 401) {
      dash.innerHTML = "<p>‚ùå Invalid GitHub token</p>";
      return;
    }
    if (repoRes.status === 403) {
      dash.innerHTML = "<p>‚ö†Ô∏è GitHub API rate limit exceeded</p>";
      return;
    }
    if (repoRes.status === 404) {
      dash.innerHTML = "<p>‚ùå Repository not found or private</p>";
      return;
    }
    if (!repoRes.ok) {
      dash.innerHTML = "<p>‚ùå GitHub API error</p>";
      return;
    }

    const repoData = await repoRes.json();

    const contents = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents`, { headers }).then(r => r.json());
    const commits = await fetch(`https://api.github.com/repos/${owner}/${repo}/commits?per_page=100`, { headers }).then(r => r.json());
    const branches = await fetch(`https://api.github.com/repos/${owner}/${repo}/branches`, { headers }).then(r => r.json());
    const pulls = await fetch(`https://api.github.com/repos/${owner}/${repo}/pulls?state=all`, { headers }).then(r => r.json());
    const languages = await fetch(`https://api.github.com/repos/${owner}/${repo}/languages`, { headers }).then(r => r.json());
    const hasReadme = await fetch(`https://api.github.com/repos/${owner}/${repo}/readme`, { headers }).then(r => r.ok);

    const files = contents.filter(c => c.type === "file").length;
    const folders = contents.filter(c => c.type === "dir").length;
    const hasTests = contents.some(c => /test|spec/i.test(c.name));

    let aiScore = 0;
    if (commits.length <= 3 && files >= 10) aiScore += 40;
    if (!hasTests) aiScore += 20;
    if (branches.length === 1) aiScore += 20;
    if (!hasReadme) aiScore += 20;

    const aiLikelihood = aiScore >= 70 ? "High" : aiScore >= 40 ? "Medium" : "Low";

    let score = 0;
    let roadmap = [];

    if (folders >= 2) score += 10; else roadmap.push("Improve folder structure");
    score += Math.min(files, 10);
    if (hasReadme) score += 15; else roadmap.push("Add README documentation");
    if (hasTests) score += 15; else roadmap.push("Add automated tests");
    if (commits.length >= 20) score += 15; else roadmap.push("Increase commit consistency");
    if (branches.length > 1) score += 10; else roadmap.push("Use feature branches");
    if (pulls.length > 0) score += 10; else roadmap.push("Adopt pull request workflow");
    if (repoData.description && repoData.description.length > 25) score += 15;
    else roadmap.push("Clarify real-world applicability");

    const level = score >= 80 ? "Advanced" : score >= 50 ? "Intermediate" : "Beginner";

    dash.innerHTML = `
      <div class="grid">
        <div class="card">
          <h3>Overall Score</h3>
          <div class="metric">${score}/100</div>
          <div class="small">${level}</div>
        </div>

        <div class="card">
          <h3>Repository Overview</h3>
          <div class="small">‚≠ê Stars: ${repoData.stargazers_count}</div>
          <div class="small">üç¥ Forks: ${repoData.forks_count}</div>
          <div class="small">üêû Issues: ${repoData.open_issues_count}</div>
        </div>

        <div class="card">
          <h3>AI-Written Code Likelihood</h3>
          <div class="metric">${aiLikelihood}</div>
          <div class="small">Heuristic-based</div>
        </div>
      </div>

      <div class="section grid">
        <div class="card">
          <h3>Tech Stack Usage</h3>
          <div class="chart-box"><canvas id="langChart"></canvas></div>
        </div>

        <div class="card">
          <h3>Development Practices</h3>
          <div class="chart-box"><canvas id="practiceChart"></canvas></div>
        </div>
      </div>

      <div class="section card">
        <h3>Detailed Evaluation (PDF Criteria)</h3>
        <ul>
          <li>Files: ${files}, Folders: ${folders}</li>
          <li>README: ${hasReadme ? "Present" : "Missing"}</li>
          <li>Tests: ${hasTests ? "Detected" : "Not detected"}</li>
          <li>Commits (last 100): ${commits.length}</li>
          <li>Branches: ${branches.length}</li>
          <li>Pull Requests: ${pulls.length}</li>
          <li>Languages: ${Object.keys(languages).join(", ")}</li>
        </ul>
      </div>

      <div class="section card">
        <h3>AI Mentor Roadmap</h3>
        <ul>${roadmap.map(r => `<li>${r}</li>`).join("")}</ul>
      </div>
    `;

    new Chart(document.getElementById("langChart"), {
      type: "doughnut",
      data: {
        labels: Object.keys(languages),
        datasets: [{ data: Object.values(languages) }]
      },
      options: { maintainAspectRatio: false }
    });

    new Chart(document.getElementById("practiceChart"), {
      type: "bar",
      data: {
        labels: ["README","Tests","Commits","Branches","PRs"],
        datasets: [{
          data: [
            hasReadme?1:0,
            hasTests?1:0,
            commits.length>=20?1:0,
            branches.length>1?1:0,
            pulls.length>0?1:0
          ]
        }]
      },
      options: {
        maintainAspectRatio:false,
        scales:{y:{ticks:{stepSize:1,callback:v=>v?"Yes":"No"}}}
      }
    });

  } catch {
    dash.innerHTML = "<p>‚ùå Network or GitHub API error</p>";
  }
}
</script>

</body>
</html>
